<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>BacktestTool</title>
	<link rel="stylesheet" href="style.css">
</head>

<body id="app">
	<div id="notify-area"></div>
	<div class="tab-container">
	  <div class="tab-group">
		<div class="tabs">
			<button class="tab-button" data-tab="tab1">List Trades</button>
			<select id="sample-select" size="1">
				<option value="EURJPY">EURJPY</option>
				<option value="EURUSD">EURUSD</option>
				<option value="GBPJPY">GBPJPY</option>
				<option value="GBPUSD">GBPUSD</option>
				<option value="USDCHF">USDCHF</option>
				<option value="XAUUSD">XAUUSD</option>
				<option value="ALL">ALL</option>
				<option value="ERROR">ERROR</option>
				<option value="UJISTAT" selected>STAT</option>
			</select>
			<button class="tab-button active" data-tab="tab2">Statistics</button>
			
		</div>
		
		<div id="tab1" class="tab-content">
			<div class="controller">
				<button id="export-btn" disabled>Copy</button>
				<label>
					<input type="checkbox" id="filter-invalid">Show invalid
				</label>
			</div>
			
			<div id="status-area"></div>
			
			<div class="table-wrapper" id="trade-table-container"></div>
		</div>
		
		<div id="tab2" class="tab-content active">
			<div class="tab-group">
		    <div class="tabs">
			    <button class="tab-button active" data-tab="overview">Overview</button>
			    <button class="tab-button" data-tab="performance">Performance</button>
			    <button class="tab-button" data-tab="drawdown">Drawdown</button>
			    <button class="tab-button" data-tab="time-based">Distribution</button>
			    <button class="tab-button" id="toggle">Switch Mode</button>
			  </div>
			  <div id="overview" class="tab-content active">
			    <div class="chart-container" id="equity-chart-container">
				    <canvas id="equity-chart"></canvas>
				    <div class="resizer"></div>
			    </div>
			    <div class="chart-container" id="pairs-chart-container">
				    <canvas id="pairs-chart"></canvas>
			    </div>
			  </div>
			  <div id="performance" class="tab-content">
			    <div class="table-wrapper" id="stats-table-container"></div>
			    
			  </div>
			  <div id="drawdown" class="tab-content">
			    
			  </div>
			  
			</div>
		</div>
		
		<div id="tab3" class="tab-content">
		  
    
			<h3>Monthly Net</h3>
			<div class="table-wrapper" id="monthly-table-container"></div>
			
			
		</div>
	    
	  </div>
		
	</div>
	<script src="/cdn/chart.min.js"></script>
  <!-- <script src="/cdn/chartjs-plugin-crosshair.min.js"></script> -->
  <script type="module" src="app.js"></script>
<script>
function initTab(container) {
  // ambil semua tab-group dalam container (termasuk nested)
  const groups = container.querySelectorAll('.tab-group');

  groups.forEach(group => {
    // gunakan :scope > ... supaya hanya anak langsung dari group
    // (modern browsers support)
    let btns, contents;
    try {
      btns = group.querySelectorAll(':scope > .tabs > .tab-button, :scope > .tab-button');
      contents = group.querySelectorAll(':scope > .tab-content');
    } catch (err) {
      // fallback bila browser tidak support :scope (sangat jarang)
      btns = Array.from(group.querySelectorAll('.tab-button')).filter(b => b.closest('.tab-group') === group);
      contents = Array.from(group.querySelectorAll('.tab-content')).filter(c => c.parentElement.closest('.tab-group') === group || c.parentElement === group);
    }

    const show = btn => {
      if (!btn) return;
      const id = btn.dataset.tab;
      // set active pada tombol anak langsung
      btns.forEach(b => b.classList.toggle('active', b === btn));
      // aktifkan hanya konten anak langsung yang id-nya cocok
      contents.forEach(c => c.classList.toggle('active', c.id === id));
    };

    group.addEventListener('click', e => {
      const btn = e.target.closest('.tab-button');
      if (!btn) return;
      // pastikan tombol itu milik group ini (bukan milik sub-group)
      if (btn.closest('.tab-group') !== group) return;
      show(btn);
    });

    // init: pilih tombol active if ada, otherwise first
    const initial = Array.from(btns).find(b => b.classList.contains('active')) || btns[0];
    show(initial);
  });
}


// init pada seluruh body (atau bisa pass element lain)
initTab(document.getElementById('app'));

</script>

<script>
// === GLOBAL ERROR HANDLER YANG BISA LIHAT NAMA FILE ASLI DI MODULE ===
function setupUltimateErrorHandler() {
  // 1. Tangkap error biasa + module
  window.onerror = function(msg, url, lineNo, columnNo, error) {
    showDetailedError(msg, url, lineNo, columnNo, error);
    return false;
  };

  // 2. Tangkap Promise rejection
  window.onunhandledrejection = function(event) {
    const error = event.reason;
    let url = 'unknown';
    let lineNo = 0;
    let columnNo = 0;

    if (error && error.stack) {
      const stackLines = error.stack.split('\n');
      // Cari baris yang mengandung file asli (bisa .js, .ts, .vue, dll)
      for (let line of stackLines) {
        const match = line.match(/\((.*):(\d+):(\d+)\)$/);
        if (match) {
          url = match[1];
          lineNo = match[2];
          columnNo = match[3];
          break;
        }
        // Untuk format tanpa kurung (Chrome terbaru)
        const match2 = line.match(/at\s+(.*):(\d+):(\d+)/);
        if (match2) {
          url = match2[1];
          lineNo = match2[2];
          columnNo = match2[3];
          break;
        }
      }
    }

    showDetailedError('UNHANDLED PROMISE REJECTION', error?.message || event.reason, url, lineNo, columnNo, error);
  };

  // Fungsi untuk tampilkan error dengan rapi + nama file asli
  function showDetailedError(message, url, lineNo, columnNo, error) {
    console.log(`%c ${error} `, 'background:#fff;color:#c0392b;font-weight:bold;');
    console.groupCollapsed('%c Detail', 'color:#e74c3c; cursor:pointer;');

    // Tampilkan nama file yang benar (bukan URL panjang)
    let fileName = url || 'unknown file';
    try {
      // Ambil hanya bagian nama file + folder terdekat (lebih bersih)
      const cleanPath = new URL(url).pathname;
      const parts = cleanPath.split('/');
      fileName = parts.slice(-3).join('/'); // contoh: src/utils/chart.js
    } catch(e) {}

    console.log('%cFile     : %c' + fileName, 'font-weight:bold;', 'color:#3498db;');
    console.log('%cLine     : %c' + lineNo +':'+ columnNo,    'font-weight:bold;', 'color:#e67e22;');
    //console.log('%cColumn   : %c' + columnNo,  'font-weight:bold;', 'color:#e67e22;');
    console.log('%cMessage  : %c' + message,   'font-weight:bold;', 'color:#e74c3c;');
    
    if (error?.stack) {
      console.log('%cStack Trace:', 'font-weight:bold;');
      console.log(error.stack);
    }

    console.groupEnd();
  }
}

// JALANKAN SEKARANG
setupUltimateErrorHandler();

//console.log('%cGlobal Error Handler ACTIVE!', 'color:#00b894;font-size:14px;font-weight:bold;');
</script>
</body>

</html>